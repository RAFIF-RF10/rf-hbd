<ion-header class="ion-no-border">
  <ion-toolbar>
    <div class="logo">
      <img src="assets/otatea-logo.png" alt="">
    </div>

    <div class="container-find">
      <ion-row>
        
        <ion-col size="10">
          <ion-searchbar
            showCancelButton="focus"
            class="custom"
            (ionInput)="onSearchChange($event)"
          ></ion-searchbar>
        </ion-col>

        <ion-col size="2">
          <div class="btn-add-card">
            <ion-button class="custom" (click)="router.navigate(['/keranjang'])">
              <ion-icon slot="icon-only" name="cart"></ion-icon>
                <ion-badge
                  *ngIf="cartCount > 0"
                  >{{ cartCount }}</ion-badge
                >
            </ion-button>
          </div>
        </ion-col>

      </ion-row>

      <div class="container-filter">
        <div
          *ngFor="let category of categories"
          class="filter"
          [class.active]="category.id === selectedFilter"
          (click)="selectFilter(category.id)"
        >
          <b>{{ category.name }}</b>
        </div>
      </div>

    </div>
  </ion-toolbar>
</ion-header>




<ion-content [fullscreen]="true">

  <div class="container-card">

      
      <ion-card size="6" *ngFor="let item of filteredItems">

        <div class="img-container">
          <img [src]="item.img_url" alt="{{ item.name }}" (click)="openDetailPage(item)" />
          <ion-button
            class="btn-cart"
            fill="solid"
            shape="round"
            (click)="openModal(item)"
          >
            <ion-icon slot="icon-only" name="bag-add-outline"></ion-icon>
          </ion-button>
        </div>

        <div class="details">
          <b>{{ item.name }}</b>
          <p>{{ item.price | currency: 'IDR':'symbol' }}</p>
        </div>
      </ion-card>


  </div>

  <ion-col size="2">
    <ion-button fill="solid" color="primary" (click)="openAddItemModal()">
      <ion-icon slot="icon-only" name="add-circle"></ion-icon>
      Tambah Item
    </ion-button>
  </ion-col>

  <ion-modal #addItemModal [canDismiss]="true" backdropDismiss="true" >
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Tambah Menu</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <div class="modal-content">
          <ion-item>
            <ion-label position="floating">Nama Produk</ion-label>
            <ion-input [(ngModel)]="itemData.name" type="text"></ion-input>
          </ion-item>
          
          <ion-item>
            <ion-label position="floating">Deskripsi</ion-label>
            <ion-textarea [(ngModel)]="itemData.description"></ion-textarea>
          </ion-item>
          
          <ion-item>
            <ion-label position="floating">Kategori</ion-label>
            <ion-select [(ngModel)]="itemData.id_category">
              <ion-select-option *ngFor="let category of categoriesList" [value]="category.id">
                {{ category.name }}
              </ion-select-option>
            </ion-select>
          </ion-item>
          
          <ion-item>
            <ion-label position="floating">Harga</ion-label>
            <ion-input [(ngModel)]="itemData.price" type="number"></ion-input>
          </ion-item>
          
          <ion-item>
            <ion-label position="floating">Foto Produk</ion-label>
            <ion-button (click)="choosePhoto()">Pilih Foto</ion-button>
          </ion-item>
          
          <ion-img *ngIf="itemData.photo" [src]="itemData.photo"></ion-img>
        </div>
  
        <ion-button expand="block" (click)="addProduct()">Tambah Item</ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>

  <ion-modal #itemModal [canDismiss]="true" backdropDismiss="true" class="custom-modal"  [initialBreakpoint]="0.5" [breakpoints]="[0, 0.5]">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title class="modal-title">Tambahkan Menu</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <div class="modal-content">
          <div class="item">
            <img [src]="selectedItem?.image" alt="{{ selectedItem?.name }}" />
            <div class="desc">
              <b>{{ selectedItem?.name }}</b>
              <p>{{ selectedItem?.price | currency: 'IDR':'symbol' }}</p>
              <div class="qty-controls">
                <ion-button (click)="decrementQty()">-</ion-button>
                <span>{{ qty }}</span>
                <ion-button (click)="incrementQty()">+</ion-button>
              </div>
            </div>
          </div>
        </div>
        <div class="btn">
          <ion-button expand="block" (click)="addToCart()">Masuk ke Troli - Rp.{{ calculateTotal() }}</ion-button>
          <!-- <ion-button expand="block" style=" --background :rgb(203, 81, 72); --color : white">Beli Sekarang - Rp. {{ calculateTotal() }}</ion-button> -->
        </div>
      </ion-content>
      <ion-footer>
      </ion-footer>
    </ng-template>
  </ion-modal>
</ion-content>
